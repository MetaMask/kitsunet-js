/* eslint-env mocha */
'use strict';
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
require("mocha");
const chai_1 = require("chai");
const events_1 = require("events");
const net_1 = require("../../src/net");
const base_protocol_1 = require("../../src/net/base-protocol");
class FakePeer extends net_1.NetworkPeer {
    constructor(id = '12345', addrs = new Set(['/ip4/127.0.0.1/tcp/5000'])) {
        super();
        this.used = false;
        this.id = '12345';
        this.addrs = new Set('/ip4/127.0.0.1/tcp/5000');
        this.id = id;
        this.addrs = addrs;
    }
}
class FakeProto extends base_protocol_1.BaseProtocol {
    handshake() {
        return __awaiter(this, void 0, void 0, function* () {
        });
    }
    constructor(id, versions, peer) {
        super(peer, {});
        this.id = id;
        this.versions = versions;
    }
}
describe('peer manager', () => {
    let nodeManager;
    let peerManager;
    let fakePeer;
    beforeEach(() => {
        nodeManager = new events_1.EventEmitter();
        peerManager = new net_1.PeerManager(nodeManager);
        fakePeer = new FakePeer();
    });
    it('should add peer', () => {
        nodeManager.emit('kitsunet:peer:connected', fakePeer);
        chai_1.expect(peerManager.peers).to.have.keys('12345');
        chai_1.expect(peerManager.peers.get('12345')).to.eql(fakePeer);
    });
    it('should remove peer', () => {
        nodeManager.emit('kitsunet:peer:disconected', fakePeer);
        chai_1.expect(peerManager.peers).to.not.have.keys('12345');
    });
    it('should retrieve peer by id', () => {
        nodeManager.emit('kitsunet:peer:connected', fakePeer);
        chai_1.expect(peerManager.getById('12345')).to.eql(fakePeer);
        chai_1.expect(fakePeer.used).to.be.eq(true);
    });
    it('should retrieve unused peers', () => {
        const peer1 = new FakePeer('12345');
        const peer2 = new FakePeer('678910');
        const peer3 = new FakePeer('1112131415');
        const peer4 = new FakePeer('1617181920');
        nodeManager.emit('kitsunet:peer:connected', peer1);
        nodeManager.emit('kitsunet:peer:connected', peer2);
        nodeManager.emit('kitsunet:peer:connected', peer3);
        nodeManager.emit('kitsunet:peer:connected', peer4);
        peer3.used = true;
        const peers = peerManager.getUnusedPeers();
        chai_1.expect(peers).to.have.members([peer1, peer2, peer4]);
    });
    it('should retrieve by capability', () => {
        const peer1 = new FakePeer('12345');
        peer1.protocols.set('proto1', new FakeProto('proto1', ['1.0.0'], peer1));
        const peer2 = new FakePeer('678910');
        peer2.protocols.set('proto2', new FakeProto('proto2', ['1.0.0'], peer2));
        const peer3 = new FakePeer('1112131415');
        peer3.protocols.set('proto3', new FakeProto('proto3', ['1.0.0'], peer3));
        const peer4 = new FakePeer('1617181920');
        peer4.protocols.set('proto4', new FakeProto('proto4', ['1.0.0'], peer4));
        nodeManager.emit('kitsunet:peer:connected', peer1);
        nodeManager.emit('kitsunet:peer:connected', peer2);
        nodeManager.emit('kitsunet:peer:connected', peer3);
        nodeManager.emit('kitsunet:peer:connected', peer4);
        const peers = peerManager.getByCapability({ id: 'proto3', versions: ['1.0.0'] });
        chai_1.expect(peers[0]).to.eql(peer3);
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGVlci1tYW5hZ2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vdGVzdC9uZXQvcGVlci1tYW5hZ2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLHNCQUFzQjtBQUV0QixZQUFZLENBQUE7Ozs7Ozs7Ozs7QUFFWixpQkFBYztBQUNkLCtCQUE2QjtBQUU3QixtQ0FBcUM7QUFDckMsdUNBTXNCO0FBQ3RCLCtEQUEwRDtBQUUxRCxNQUFNLFFBQVMsU0FBUSxpQkFBcUI7SUFNMUMsWUFBYSxLQUFhLE9BQU8sRUFDcEIsUUFBcUIsSUFBSSxHQUFHLENBQUMsQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO1FBQ3BFLEtBQUssRUFBRSxDQUFBO1FBUFQsU0FBSSxHQUFZLEtBQUssQ0FBQTtRQUVyQixPQUFFLEdBQVcsT0FBTyxDQUFBO1FBQ3BCLFVBQUssR0FBZ0IsSUFBSSxHQUFHLENBQUMseUJBQXlCLENBQUMsQ0FBQTtRQU1yRCxJQUFJLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQTtRQUNaLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFBO0lBQ3BCLENBQUM7Q0FDRjtBQUVELE1BQU0sU0FBVSxTQUFRLDRCQUFzQjtJQUN0QyxTQUFTOztRQUNmLENBQUM7S0FBQTtJQUtELFlBQWEsRUFBVSxFQUFFLFFBQWtCLEVBQUUsSUFBYztRQUN6RCxLQUFLLENBQUMsSUFBSSxFQUFFLEVBQW9CLENBQUMsQ0FBQTtRQUNqQyxJQUFJLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQTtRQUNaLElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFBO0lBQzFCLENBQUM7Q0FDRjtBQUVELFFBQVEsQ0FBQyxjQUFjLEVBQUUsR0FBRyxFQUFFO0lBQzVCLElBQUksV0FBNkIsQ0FBQTtJQUNqQyxJQUFJLFdBQXdCLENBQUE7SUFDNUIsSUFBSSxRQUFjLENBQUE7SUFFbEIsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLFdBQVcsR0FBRyxJQUFJLHFCQUFZLEVBQXNCLENBQUE7UUFDcEQsV0FBVyxHQUFHLElBQUksaUJBQVcsQ0FBQyxXQUFXLENBQUMsQ0FBQTtRQUMxQyxRQUFRLEdBQUcsSUFBSSxRQUFRLEVBQUUsQ0FBQTtJQUMzQixDQUFDLENBQUMsQ0FBQTtJQUVGLEVBQUUsQ0FBQyxpQkFBaUIsRUFBRSxHQUFHLEVBQUU7UUFDekIsV0FBVyxDQUFDLElBQUksQ0FBQyx5QkFBeUIsRUFBRSxRQUFRLENBQUMsQ0FBQTtRQUNyRCxhQUFNLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFBO1FBQy9DLGFBQU0sQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLENBQUE7SUFDekQsQ0FBQyxDQUFDLENBQUE7SUFFRixFQUFFLENBQUMsb0JBQW9CLEVBQUUsR0FBRyxFQUFFO1FBQzVCLFdBQVcsQ0FBQyxJQUFJLENBQUMsMkJBQTJCLEVBQUUsUUFBUSxDQUFDLENBQUE7UUFDdkQsYUFBTSxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUE7SUFDckQsQ0FBQyxDQUFDLENBQUE7SUFFRixFQUFFLENBQUMsNEJBQTRCLEVBQUUsR0FBRyxFQUFFO1FBQ3BDLFdBQVcsQ0FBQyxJQUFJLENBQUMseUJBQXlCLEVBQUUsUUFBUSxDQUFDLENBQUE7UUFDckQsYUFBTSxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFBO1FBQ3JELGFBQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUE7SUFDdEMsQ0FBQyxDQUFDLENBQUE7SUFFRixFQUFFLENBQUMsOEJBQThCLEVBQUUsR0FBRyxFQUFFO1FBQ3RDLE1BQU0sS0FBSyxHQUFHLElBQUksUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFBO1FBQ25DLE1BQU0sS0FBSyxHQUFHLElBQUksUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFBO1FBQ3BDLE1BQU0sS0FBSyxHQUFHLElBQUksUUFBUSxDQUFDLFlBQVksQ0FBQyxDQUFBO1FBQ3hDLE1BQU0sS0FBSyxHQUFHLElBQUksUUFBUSxDQUFDLFlBQVksQ0FBQyxDQUFBO1FBRXhDLFdBQVcsQ0FBQyxJQUFJLENBQUMseUJBQXlCLEVBQUUsS0FBSyxDQUFDLENBQUE7UUFDbEQsV0FBVyxDQUFDLElBQUksQ0FBQyx5QkFBeUIsRUFBRSxLQUFLLENBQUMsQ0FBQTtRQUNsRCxXQUFXLENBQUMsSUFBSSxDQUFDLHlCQUF5QixFQUFFLEtBQUssQ0FBQyxDQUFBO1FBQ2xELFdBQVcsQ0FBQyxJQUFJLENBQUMseUJBQXlCLEVBQUUsS0FBSyxDQUFDLENBQUE7UUFDbEQsS0FBSyxDQUFDLElBQUksR0FBRyxJQUFJLENBQUE7UUFDakIsTUFBTSxLQUFLLEdBQUcsV0FBVyxDQUFDLGNBQWMsRUFBRSxDQUFBO1FBQzFDLGFBQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQTtJQUN0RCxDQUFDLENBQUMsQ0FBQTtJQUVGLEVBQUUsQ0FBQywrQkFBK0IsRUFBRSxHQUFHLEVBQUU7UUFDdkMsTUFBTSxLQUFLLEdBQUcsSUFBSSxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUE7UUFDbkMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLElBQUksU0FBUyxDQUFDLFFBQVEsRUFBRSxDQUFDLE9BQU8sQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUE7UUFFeEUsTUFBTSxLQUFLLEdBQUcsSUFBSSxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUE7UUFDcEMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLElBQUksU0FBUyxDQUFDLFFBQVEsRUFBRSxDQUFDLE9BQU8sQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUE7UUFFeEUsTUFBTSxLQUFLLEdBQUcsSUFBSSxRQUFRLENBQUMsWUFBWSxDQUFDLENBQUE7UUFDeEMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLElBQUksU0FBUyxDQUFDLFFBQVEsRUFBRSxDQUFDLE9BQU8sQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUE7UUFFeEUsTUFBTSxLQUFLLEdBQUcsSUFBSSxRQUFRLENBQUMsWUFBWSxDQUFDLENBQUE7UUFDeEMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLElBQUksU0FBUyxDQUFDLFFBQVEsRUFBRSxDQUFDLE9BQU8sQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUE7UUFFeEUsV0FBVyxDQUFDLElBQUksQ0FBQyx5QkFBeUIsRUFBRSxLQUFLLENBQUMsQ0FBQTtRQUNsRCxXQUFXLENBQUMsSUFBSSxDQUFDLHlCQUF5QixFQUFFLEtBQUssQ0FBQyxDQUFBO1FBQ2xELFdBQVcsQ0FBQyxJQUFJLENBQUMseUJBQXlCLEVBQUUsS0FBSyxDQUFDLENBQUE7UUFDbEQsV0FBVyxDQUFDLElBQUksQ0FBQyx5QkFBeUIsRUFBRSxLQUFLLENBQUMsQ0FBQTtRQUNsRCxNQUFNLEtBQUssR0FBRyxXQUFXLENBQUMsZUFBZSxDQUFDLEVBQUUsRUFBRSxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLENBQUE7UUFDaEYsYUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUE7SUFDaEMsQ0FBQyxDQUFDLENBQUE7QUFDSixDQUFDLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludC1lbnYgbW9jaGEgKi9cblxuJ3VzZSBzdHJpY3QnXG5cbmltcG9ydCAnbW9jaGEnXG5pbXBvcnQgeyBleHBlY3QgfSBmcm9tICdjaGFpJ1xuXG5pbXBvcnQgeyBFdmVudEVtaXR0ZXIgfSBmcm9tICdldmVudHMnXG5pbXBvcnQge1xuICBQZWVyTWFuYWdlcixcbiAgTmV0d29ya1BlZXIsXG4gIE5vZGUsXG4gIE5vZGVNYW5hZ2VyLFxuICBQZWVyXG59IGZyb20gJy4uLy4uL3NyYy9uZXQnXG5pbXBvcnQgeyBCYXNlUHJvdG9jb2wgfSBmcm9tICcuLi8uLi9zcmMvbmV0L2Jhc2UtcHJvdG9jb2wnXG5cbmNsYXNzIEZha2VQZWVyIGV4dGVuZHMgTmV0d29ya1BlZXI8YW55LCBhbnk+IHtcbiAgdXNlZDogYm9vbGVhbiA9IGZhbHNlXG4gIHBlZXI6IGFueVxuICBpZDogc3RyaW5nID0gJzEyMzQ1J1xuICBhZGRyczogU2V0PHN0cmluZz4gPSBuZXcgU2V0KCcvaXA0LzEyNy4wLjAuMS90Y3AvNTAwMCcpXG5cbiAgY29uc3RydWN0b3IgKGlkOiBzdHJpbmcgPSAnMTIzNDUnLFxuICAgICAgICAgICAgICAgYWRkcnM6IFNldDxzdHJpbmc+ID0gbmV3IFNldChbJy9pcDQvMTI3LjAuMC4xL3RjcC81MDAwJ10pKSB7XG4gICAgc3VwZXIoKVxuXG4gICAgdGhpcy5pZCA9IGlkXG4gICAgdGhpcy5hZGRycyA9IGFkZHJzXG4gIH1cbn1cblxuY2xhc3MgRmFrZVByb3RvIGV4dGVuZHMgQmFzZVByb3RvY29sPEZha2VQZWVyPiB7XG4gIGFzeW5jIGhhbmRzaGFrZSAoKTogUHJvbWlzZTx2b2lkPiB7XG4gIH1cblxuICBpZDogc3RyaW5nXG4gIHZlcnNpb25zOiBzdHJpbmdbXVxuXG4gIGNvbnN0cnVjdG9yIChpZDogc3RyaW5nLCB2ZXJzaW9uczogc3RyaW5nW10sIHBlZXI6IEZha2VQZWVyKSB7XG4gICAgc3VwZXIocGVlciwge30gYXMgTm9kZTxGYWtlUGVlcj4pXG4gICAgdGhpcy5pZCA9IGlkXG4gICAgdGhpcy52ZXJzaW9ucyA9IHZlcnNpb25zXG4gIH1cbn1cblxuZGVzY3JpYmUoJ3BlZXIgbWFuYWdlcicsICgpID0+IHtcbiAgbGV0IG5vZGVNYW5hZ2VyOiBOb2RlTWFuYWdlcjxhbnk+XG4gIGxldCBwZWVyTWFuYWdlcjogUGVlck1hbmFnZXJcbiAgbGV0IGZha2VQZWVyOiBQZWVyXG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgbm9kZU1hbmFnZXIgPSBuZXcgRXZlbnRFbWl0dGVyKCkgYXMgTm9kZU1hbmFnZXI8YW55PlxuICAgIHBlZXJNYW5hZ2VyID0gbmV3IFBlZXJNYW5hZ2VyKG5vZGVNYW5hZ2VyKVxuICAgIGZha2VQZWVyID0gbmV3IEZha2VQZWVyKClcbiAgfSlcblxuICBpdCgnc2hvdWxkIGFkZCBwZWVyJywgKCkgPT4ge1xuICAgIG5vZGVNYW5hZ2VyLmVtaXQoJ2tpdHN1bmV0OnBlZXI6Y29ubmVjdGVkJywgZmFrZVBlZXIpXG4gICAgZXhwZWN0KHBlZXJNYW5hZ2VyLnBlZXJzKS50by5oYXZlLmtleXMoJzEyMzQ1JylcbiAgICBleHBlY3QocGVlck1hbmFnZXIucGVlcnMuZ2V0KCcxMjM0NScpKS50by5lcWwoZmFrZVBlZXIpXG4gIH0pXG5cbiAgaXQoJ3Nob3VsZCByZW1vdmUgcGVlcicsICgpID0+IHtcbiAgICBub2RlTWFuYWdlci5lbWl0KCdraXRzdW5ldDpwZWVyOmRpc2NvbmVjdGVkJywgZmFrZVBlZXIpXG4gICAgZXhwZWN0KHBlZXJNYW5hZ2VyLnBlZXJzKS50by5ub3QuaGF2ZS5rZXlzKCcxMjM0NScpXG4gIH0pXG5cbiAgaXQoJ3Nob3VsZCByZXRyaWV2ZSBwZWVyIGJ5IGlkJywgKCkgPT4ge1xuICAgIG5vZGVNYW5hZ2VyLmVtaXQoJ2tpdHN1bmV0OnBlZXI6Y29ubmVjdGVkJywgZmFrZVBlZXIpXG4gICAgZXhwZWN0KHBlZXJNYW5hZ2VyLmdldEJ5SWQoJzEyMzQ1JykpLnRvLmVxbChmYWtlUGVlcilcbiAgICBleHBlY3QoZmFrZVBlZXIudXNlZCkudG8uYmUuZXEodHJ1ZSlcbiAgfSlcblxuICBpdCgnc2hvdWxkIHJldHJpZXZlIHVudXNlZCBwZWVycycsICgpID0+IHtcbiAgICBjb25zdCBwZWVyMSA9IG5ldyBGYWtlUGVlcignMTIzNDUnKVxuICAgIGNvbnN0IHBlZXIyID0gbmV3IEZha2VQZWVyKCc2Nzg5MTAnKVxuICAgIGNvbnN0IHBlZXIzID0gbmV3IEZha2VQZWVyKCcxMTEyMTMxNDE1JylcbiAgICBjb25zdCBwZWVyNCA9IG5ldyBGYWtlUGVlcignMTYxNzE4MTkyMCcpXG5cbiAgICBub2RlTWFuYWdlci5lbWl0KCdraXRzdW5ldDpwZWVyOmNvbm5lY3RlZCcsIHBlZXIxKVxuICAgIG5vZGVNYW5hZ2VyLmVtaXQoJ2tpdHN1bmV0OnBlZXI6Y29ubmVjdGVkJywgcGVlcjIpXG4gICAgbm9kZU1hbmFnZXIuZW1pdCgna2l0c3VuZXQ6cGVlcjpjb25uZWN0ZWQnLCBwZWVyMylcbiAgICBub2RlTWFuYWdlci5lbWl0KCdraXRzdW5ldDpwZWVyOmNvbm5lY3RlZCcsIHBlZXI0KVxuICAgIHBlZXIzLnVzZWQgPSB0cnVlXG4gICAgY29uc3QgcGVlcnMgPSBwZWVyTWFuYWdlci5nZXRVbnVzZWRQZWVycygpXG4gICAgZXhwZWN0KHBlZXJzKS50by5oYXZlLm1lbWJlcnMoW3BlZXIxLCBwZWVyMiwgcGVlcjRdKVxuICB9KVxuXG4gIGl0KCdzaG91bGQgcmV0cmlldmUgYnkgY2FwYWJpbGl0eScsICgpID0+IHtcbiAgICBjb25zdCBwZWVyMSA9IG5ldyBGYWtlUGVlcignMTIzNDUnKVxuICAgIHBlZXIxLnByb3RvY29scy5zZXQoJ3Byb3RvMScsIG5ldyBGYWtlUHJvdG8oJ3Byb3RvMScsIFsnMS4wLjAnXSwgcGVlcjEpKVxuXG4gICAgY29uc3QgcGVlcjIgPSBuZXcgRmFrZVBlZXIoJzY3ODkxMCcpXG4gICAgcGVlcjIucHJvdG9jb2xzLnNldCgncHJvdG8yJywgbmV3IEZha2VQcm90bygncHJvdG8yJywgWycxLjAuMCddLCBwZWVyMikpXG5cbiAgICBjb25zdCBwZWVyMyA9IG5ldyBGYWtlUGVlcignMTExMjEzMTQxNScpXG4gICAgcGVlcjMucHJvdG9jb2xzLnNldCgncHJvdG8zJywgbmV3IEZha2VQcm90bygncHJvdG8zJywgWycxLjAuMCddLCBwZWVyMykpXG5cbiAgICBjb25zdCBwZWVyNCA9IG5ldyBGYWtlUGVlcignMTYxNzE4MTkyMCcpXG4gICAgcGVlcjQucHJvdG9jb2xzLnNldCgncHJvdG80JywgbmV3IEZha2VQcm90bygncHJvdG80JywgWycxLjAuMCddLCBwZWVyNCkpXG5cbiAgICBub2RlTWFuYWdlci5lbWl0KCdraXRzdW5ldDpwZWVyOmNvbm5lY3RlZCcsIHBlZXIxKVxuICAgIG5vZGVNYW5hZ2VyLmVtaXQoJ2tpdHN1bmV0OnBlZXI6Y29ubmVjdGVkJywgcGVlcjIpXG4gICAgbm9kZU1hbmFnZXIuZW1pdCgna2l0c3VuZXQ6cGVlcjpjb25uZWN0ZWQnLCBwZWVyMylcbiAgICBub2RlTWFuYWdlci5lbWl0KCdraXRzdW5ldDpwZWVyOmNvbm5lY3RlZCcsIHBlZXI0KVxuICAgIGNvbnN0IHBlZXJzID0gcGVlck1hbmFnZXIuZ2V0QnlDYXBhYmlsaXR5KHsgaWQ6ICdwcm90bzMnLCB2ZXJzaW9uczogWycxLjAuMCddIH0pXG4gICAgZXhwZWN0KHBlZXJzWzBdKS50by5lcWwocGVlcjMpXG4gIH0pXG59KVxuIl19